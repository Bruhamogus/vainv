<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vein (V) to USD+ Converter</title>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
    <style>
        /* Simple styles */
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }
        input {
            padding: 10px;
            margin: 10px;
            width: 200px;
        }
        button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        #status {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Convert Vein (V) to USD+</h1>

    <button id="connectButton" onclick="connectMetaMask()">Connect MetaMask</button>

    <div>
        <label for="veinAmount">Enter Vein (V) amount to convert: </label>
        <input type="number" id="veinAmount" placeholder="Amount of Vein" min="1">
    </div>

    <div>
        <label for="receiverAddress">Receiver's Address: </label>
        <input type="text" id="receiverAddress" placeholder="0xAddress">
    </div>

    <button onclick="convertVeinToUSDPlus()">Convert to USD+</button>

    <div id="status"></div>
</div>

<script>
    let web3;
    let contract;
    let veinToken;
    const SMARTCONTRACT = '0xbb52e681039076d964301ae2dD23e1Bd35A51b1e'; // Contract address for Vein (V)
    const USDPLUS_CONTRACT = '0xYourUSDPlusContractAddress'; // Replace with USD+ contract address
    const veinTokenAddress = '0x4cf38311571bae9e82edea467e8a5fbb306731d7477447ce44b9f4a09e26706a'; // Vein (V) contract
    const priceFeedAddress = '0xd5Ec94430eF4170D819E0996BC53ed40d31638d8'; // Chainlink price feed for USD+

    // ABI for Vein (V) contract
    const veinTokenABI = [
        {
            "constant": true,
            "inputs": [{ "name": "account", "type": "address" }],
            "name": "balanceOf",
            "outputs": [{ "name": "", "type": "uint256" }],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        }
    ];

    // ABI for Chainlink price feed (USD+)
    const priceFeedABI = [
        {
            "constant": true,
            "inputs": [],
            "name": "latestRoundData",
            "outputs": [
                { "name": "roundId", "type": "uint80" },
                { "name": "answer", "type": "int256" },
                { "name": "startedAt", "type": "uint256" },
                { "name": "updatedAt", "type": "uint256" },
                { "name": "answeredInRound", "type": "uint80" }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        }
    ];

    // Function to initialize Web3 and contracts
    function initializeContracts() {
        if (web3) {
            contract = new web3.eth.Contract(priceFeedABI, priceFeedAddress);
            veinToken = new web3.eth.Contract(veinTokenABI, veinTokenAddress);
        } else {
            alert("Web3 not initialized.");
        }
    }

    // Connect MetaMask
    async function connectMetaMask() {
        if (typeof window.ethereum !== 'undefined') {
            web3 = new Web3(window.ethereum);
            try {
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                initializeContracts();
                const accounts = await web3.eth.getAccounts();
                document.getElementById('status').innerText = `Connected to MetaMask: ${accounts[0]}`;
            } catch (error) {
                alert("Please connect to MetaMask!");
            }
        } else {
            alert("MetaMask not found. Please install MetaMask!");
        }
    }

    // Convert Vein (V) to USD+
    async function convertVeinToUSDPlus() {
        const amount = document.getElementById("veinAmount").value;
        const receiverAddress = document.getElementById("receiverAddress").value;
        const status = document.getElementById("status");

        if (!amount || amount <= 0) {
            status.innerText = "Please enter a valid Vein amount!";
            return;
        }

        if (!receiverAddress || !web3.utils.isAddress(receiverAddress)) {
            status.innerText = "Please enter a valid receiver address!";
            return;
        }

        try {
            const accounts = await web3.eth.getAccounts();
            const userAccount = accounts[0];

            // Get the current USD+ price from the Chainlink price feed
            const priceData = await contract.methods.latestRoundData().call();
            const usdPlusPrice = priceData.answer / 1e8; // Adjust for decimals if needed

            // Calculate the amount of USD+ to send
            const usdPlusAmount = amount * usdPlusPrice;

            status.innerText = `Converting ${amount} Vein to USD+...`;

            // Transfer USD+ to the receiver address
            const usdPlusContract = new web3.eth.Contract(veinTokenABI, USDPLUS_CONTRACT); // USD+ contract instance
            await usdPlusContract.methods.transfer(receiverAddress, web3.utils.toWei(usdPlusAmount.toString(), 'ether')).send({ from: userAccount });

            status.innerText = `Conversion successful! ${amount} Vein tokens have been converted to USD+ and sent to ${receiverAddress}.`;
        } catch (error) {
            console.error("Error during conversion:", error);
            status.innerText = "An error occurred during conversion.";
        }
    }
</script>

</body>
</html>
